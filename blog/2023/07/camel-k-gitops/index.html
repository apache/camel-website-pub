<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../../../../apple-touch-icon-57x57.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../../../../apple-touch-icon-114x114.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../../../../apple-touch-icon-72x72.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../../../../apple-touch-icon-144x144.png"> <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../../../../apple-touch-icon-60x60.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../../../../apple-touch-icon-120x120.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../../../../apple-touch-icon-76x76.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../../apple-touch-icon-152x152.png"> <link rel="icon" type="image/png" href="../../../../favicon-196x196.png" sizes="196x196"> <link rel="icon" type="image/png" href="../../../../favicon-96x96.png" sizes="96x96"> <link rel="icon" type="image/png" href="../../../../favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="../../../../favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="../../../../favicon-128.png" sizes="128x128"> <meta name="application-name" content="Apache Camel"> <meta property="og:title" content="Camel K GitOps"> <meta property="og:site_name" content="Apache Camel"> <meta property="og:url" content="https://camel.apache.org/blog/2023/07/camel-k-gitops/"> <meta name="og:description" content="How to apply GitOps with Camel K, Kustomize and ArgoCD."> <meta property="og:type" content="website"> <meta property="og:image" content="https://camel.apache.org/blog/2023/07/camel-k-gitops/featured.png"> <link rel="manifest" href="../../../../site.webmanifest"> <title>Camel K GitOps - Apache Camel</title> <link rel="canonical" href="https://camel.apache.org/blog/2023/07/camel-k-gitops/"> <link rel="stylesheet" href="../../../../_/css/site-b287b96c63.css"> </head> <body class="article"> <header class="header" aria-label="Header"> <nav class="navbar" aria-label="Main menu"> <div class="navbar-brand"> <a class="nav-logo" href="../../../../" title="Apache Camel"></a> <div id="topbar-nav" class="navbar-menu"> <div class="navbar-end"> <a class="navbar-item-section navbar-item navbar-topics" href="../../../../blog/"> <img alt="Blog" src="../../../../_/img/blog-4c7fa4cb60.svg"> Blog </a> <a class="navbar-item-section navbar-item navbar-topics" href="../../../../docs/"> <img alt="Documentation" src="../../../../_/img/documentation-abb1b7f8b1.svg"> Documentation </a> <a class="navbar-item-section navbar-item navbar-topics" href="../../../../community/"> <img alt="Community" src="../../../../_/img/community-2ec8a3dc8b.svg"> Community </a> <a class="navbar-item-section navbar-item navbar-topics" href="../../../../download/"> <img alt="Download" src="../../../../_/img/download-63cdd75074.svg"> Download </a> <a class="navbar-item-section navbar-item navbar-topics" href="../../../../security/"> <img alt="Security" src="../../../../_/img/security-06abe157b3.svg"> Security </a> </div> </div> <div class="navbar-fill"></div> <div class="break-row"></div> <div class="navbar-search results-hidden"> <input id="search" class="search" placeholder="Search" autocomplete="off"> <img src="/_/img/cancel-1ed239489b.svg" alt="Clear" id="search-cancel"> <div id="search_results"></div> </div> <div class="navbar-tools"> <a rel="noopener noreferrer nofollow" href="https://github.com/apache/camel/" title="Collaborate on GitHub"><svg focusable="false" class="brand-icon"><use href="../../../../_/img/brand-logos-f2e689f4d4.svg#github"/></svg></a> <a rel="noopener noreferrer nofollow" href="https://camel.zulipchat.com" title="Chat on Zulip"><svg focusable="false" class="brand-icon"><use href="../../../../_/img/brand-logos-f2e689f4d4.svg#zulip"/></svg></a> <a rel="noopener noreferrer nofollow" href="https://twitter.com/ApacheCamel" title="Follow Apache Camel on Twitter"><svg focusable="false" class="brand-icon"><use href="../../../../_/img/brand-logos-f2e689f4d4.svg#twitter"/></svg></a> <a rel="noopener noreferrer nofollow" href="https://www.linkedin.com/groups/2447439/" title="Apache Camel group on Linkedin"><svg focusable="false" class="brand-icon"><use href="../../../../_/img/brand-logos-f2e689f4d4.svg#linkedin"/></svg></a> </div> <button class="navbar-burger" data-target="topbar-nav" type="button" aria-label="Menu"> <span></span> <span></span> <span></span> </button> </div> </nav> </header> <a id="top"></a> <div class="body"> <main role="main blog"> <article class="blog doc"> <header aria-labelledby="title"> <a class="category" href="../../../../categories/Howtos/">HOWTOS</a><a class="category" href="../../../../categories/Camel-K/">CAMEL K</a><a class="category" href="../../../../categories/Operations/">OPERATIONS</a> <h1 id="title">Camel K GitOps</h1> </header> <div class="post"> <aside aria-label="Post details"> <div class="summary">How to apply GitOps with Camel K, Kustomize and ArgoCD.</div> Posted on <time itemprop="published" datetime="2023-07-10" title="Monday, July 10, 2023">July 10, 2023</time>, by <figure> <img src="https://avatars.githubusercontent.com/u/23169723?v=4" alt="Pasquale Congiusti"> <figcaption rel="author">Pasquale Congiusti</figcaption> </figure> <h4>Share this blog</h4> <a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fcamel.apache.org%2fblog%2f2023%2f07%2fcamel-k-gitops%2f" target="_blank" rel="noopener" aria-label="Share on Facebook"> <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" focusable="false"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/></svg> </div> </div> </a> <a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=Camel%20K%20GitOps&url=https%3a%2f%2fcamel.apache.org%2fblog%2f2023%2f07%2fcamel-k-gitops%2f&hashtags=ApacheCamel" target="_blank" rel="noopener" aria-label="Share on Twitter"> <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" focusable="false"><path d="M23.44 4.83c-.8.37-1.5.38-2.22.02.93-.56.98-.96 1.32-2.02-.88.52-1.86.9-2.9 1.1-.82-.88-2-1.43-3.3-1.43-2.5 0-4.55 2.04-4.55 4.54 0 .36.03.7.1 1.04-3.77-.2-7.12-2-9.36-4.75-.4.67-.6 1.45-.6 2.3 0 1.56.8 2.95 2 3.77-.74-.03-1.44-.23-2.05-.57v.06c0 2.2 1.56 4.03 3.64 4.44-.67.2-1.37.2-2.06.08.58 1.8 2.26 3.12 4.25 3.16C5.78 18.1 3.37 18.74 1 18.46c2 1.3 4.4 2.04 6.97 2.04 8.35 0 12.92-6.92 12.92-12.93 0-.2 0-.4-.02-.6.9-.63 1.96-1.22 2.56-2.14z"/></svg> </div> </div> </a> <a class="resp-sharing-button__link" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fcamel.apache.org%2fblog%2f2023%2f07%2fcamel-k-gitops%2f&title=Camel%20K%20GitOps&summary=How%20to%20apply%20GitOps%20with%20Camel%20K%2c%20Kustomize%20and%20ArgoCD.&source=https%3A%2F%2Fcamel.apache.org" target="_blank" rel="noopener" aria-label="Share on LinkedIn" title="Share on LinkedIn"> <div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" focusable="false"><path d="M6.5 21.5h-5v-13h5v13zM4 6.5C2.5 6.5 1.5 5.3 1.5 4s1-2.4 2.5-2.4c1.6 0 2.5 1 2.6 2.5 0 1.4-1 2.5-2.6 2.5zm11.5 6c-1 0-2 1-2 2v7h-5v-13h5V10s1.6-1.5 4-1.5c3 0 5 2.2 5 6.3v6.7h-5v-7c0-1-1-2-2-2z"/></svg> </div> </div> </a> <p> <a class="arrow prev" href="../../../../blog/2023/07/multi-release-vscode-extensions/" title="Previous post: New releases of VS Code Extensions: Language Support 0.9.0, Debug Adapter 0.8.0, Tooling for Camel K 0.0.34">&#10094;</a> <a class="arrow next" href="../../../../blog/2023/07/camel-karavan-3.21.0/" title="Next post: Karavan 3.21.0: Developer Performance Accelerator">&#10095;</a> </p> </aside> <div class="post-content"> <img class="featured" alt="Blog post featured image" src="../../../../blog/2023/07/camel-k-gitops/featured_hu8f055628b8784dc48030d9e9d826ded2_53752_800x0_resize_q95_gaussian_3.png" width="800" height="468"> <p>In this blog post we&rsquo;ll be talking about <strong>GitOps</strong> and we&rsquo;ll provide some approach that we hope can help you understand better how you can do such kind of operations togheter with Camel K. As we&rsquo;re talking about processes, all the discussion we&rsquo;re going to provide can be different in each company, environment and according the set of tools you&rsquo;re using.</p> <p>The idea of the blog is to show the possibilities offered by Camel K in order to help you understand better how you can adapt your own tools and process to Camel K deployment model.</p> <h1 id="whats-gitops">What&rsquo;s GitOps</h1> <p>GitOps is a paradigm used to manage cloud-native applications. The main focus, as the name suggest is to have a &ldquo;Git-centric&rdquo; approach, where the developer provides any required change of a cloud native application on the source code repository, and some CD tool takes care to apply such changes in the target cluster. It matches very well in a microservice oriented architecture and if you&rsquo;re willing to provide a continuous delivery for your application.</p> <h1 id="a-simple-gitops-strategy-with-camel-k">A simple GitOps strategy with Camel K</h1> <p>Let&rsquo;s see how we can get the full benefits of <strong>GitOps with Camel K</strong> with some example. The route example chosen is very simple, as we just want to illustrate the process we&rsquo;ve followed. It should be easy enough to apply the same approach to more complex routes.</p> <p>The process we&rsquo;re following is one that we think tipically applies to most of the companies:</p> <ul> <li>we create a route, testing it in a development environment</li> <li>we package the configuration required to run with a GitOps CICD tool</li> <li>we push the changes to a Git repository</li> <li>we provide the CD configuration targetting the Git repository</li> <li>we apply any application change to the Git repository</li> </ul> <h2 id="camel-k-environments-topology">Camel K environments topology</h2> <p>Before starting with the example, I think it&rsquo;s important to understand how Camel K manages the different environments and how we can make each environment to share artifacts. What we finally want to do is to test some application in the development environment and later use the very same application (which we suppose has been throughoutfully tested) in a production environment.</p> <p>In Camel K we use the container registry as the common place where to store the artifacts we use to run the applications. When you create an Integration, the Camel K operator is in charge to build (or reuse) a container image which is stored in the container registry. Once the image is available you can use it in any other environment/cluster.</p> <p>We can think on three different topologies:</p> <img src="single_cluster.png" alt="Single cluster, shared container registry" style="width:560px;height:774px;"> <p>This is the simples topology where you have a single cluster and a logical separation with namespaces. In such configuration you need to have both operators to share the same container registry.</p> <img src="multi_cluster.png" alt="Separate clusters, shared container registry" style="width:650px;height:754px;"> <p>Here you will have a physical separation as there are two separate clusters. However, in order to properly use the containers tested in development, both operators needs also to share the same container registry.</p> <img src="multi_cluster_sync.png" alt="Separate clusters, synchronized container registries" style="width:600px;height:794px;"> <p>This topology is similar to the previous one, but you have dedicated container registries. The only caveat is that you need to put in place a mechanism to promote (or synchronize) the containers images which are created in development.</p> <p>Whichever is the topology you&rsquo;re choosing there won&rsquo;t be any change in the way we&rsquo;re performing our deployment operations when we adopt a GitOps strategy. Each environment (or cluster) will have to provide the proper CD configuration targeting the Git repository (and the right profile).</p> <h2 id="directory-structure-preparation">Directory structure preparation</h2> <p>The first thing we can do is to provide a folder based structure that will host our example and it will be the source for our Git repository. We&rsquo;re going to use <a href="https://kustomize.io/" rel="noopener nofollow noreferrer">Kustomize</a> as we think it&rsquo;s easier to provide different &ldquo;profiles&rdquo;, so, if you&rsquo;re using other methodologies, the organization may change accordingly.</p> <pre tabindex="0"><code>mkdir -p my-ck-gitops
mkdir -p my-ck-gitops/base
mkdir -p my-ck-gitops/overlays/dev
mkdir -p my-ck-gitops/overlays/prod
cd my-ck-gitops
</code></pre><p>We&rsquo;ve used the generic approach suggested in this <a href="https://codefresh.io/blog/how-to-model-your-gitops-environments-and-promote-releases-between-them/" rel="noopener nofollow noreferrer">GitOps promotion model article</a>. With this configuration we have a <em>base</em> directory which we use to store all the generic configuration and two <em>overlays</em> directories where we define the customization which is related to <em>development</em> and productions <em>environments</em>.</p> <h2 id="prepare-development-integration">Prepare development Integration</h2> <p>You can do the development according your company strategy, using <a href="../../../../blog/2022/11/camel-k-jbang/">Camel JBang</a>, a <a href="https://github.com/apache/camel-k/tree/main/cicd/tekton/kamel-run/0.1" rel="noopener nofollow noreferrer">pipeline</a> or directly the <code>kamel</code> CLI. As we want to just focus on the GitOps part, we&rsquo;re using <code>kamel</code> CLI which results more self-explainatory for the blog purpose.</p> <p>Everything starts with some kind of prototype. We can create a <code>my-route.yaml</code> route which we&rsquo;ll populate with some YAML DSL. The YAML route we&rsquo;re creating is using some configmap in order to show how we can apply configuration dynamically based on the environment we run. You can image the same when applied to databases, services, etcetera.</p> <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl">- <span class="nt">from</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;timer:yaml&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">period</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;1000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">setBody</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">simple</span><span class="p">:</span><span class="w"> </span><span class="l">resource:classpath:my-configmap-file</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;log:info&#34;</span><span class="w">
</span></span></span></code></pre></div><p>Before testing the route in a cluster, let&rsquo;s also create a configmap using <code>kubectl</code> for simplicity:</p> <pre tabindex="0"><code>kubectl create cm my-cm --from-literal my-configmap-file=&#34;I am a development environment&#34;
</code></pre><p>Once this is applied, we can run the Integration:</p> <pre tabindex="0"><code>kamel run my-route.yaml --dev --config configmap:my-cm
</code></pre><p>As this is a development environment, we do want to limit the quantity of resource used. Let&rsquo;s use the Container trait for this purpose:</p> <pre tabindex="0"><code>kamel run my-route.yaml --config configmap:my-cm -t container.limit-cpu=0.1 -t container.limit-memory=256Mi
</code></pre><p>Once we&rsquo;re happy with the test, we&rsquo;re ready to wrap it into a Git repository which we&rsquo;ll be using for all our GitOps operations.</p> <h3 id="git-repository">Git repository</h3> <p>At this stage we can export the Integration either by getting the value from the cluster or reusing the same <code>kamel</code> CLI with the dry-run option. Let&rsquo;s use this second approach as it frees us by the need to remove the <code>.spec.status</code> of the Integration:</p> <pre tabindex="0"><code>kamel run my-route.yaml --config configmap:my-cm -t container.limit-cpu=0.1 -t container.limit-memory=256Mi -o yaml &gt; base/my-it.yaml
</code></pre><p>We can use Kustomize now to provide the configuration required for development profile:</p> <pre tabindex="0"><code>cd base/
kustomize create --resources my-it.yaml
kustomize edit add configmap my-cm --from-literal=my-configmap-file=&#34;I am a default environment&#34; --behavior create --disableNameSuffixHash
cd ../overlays/dev/
kustomize create --resources ../../base
kustomize edit add configmap my-cm --from-literal=my-configmap-file=&#34;I am a development environment&#34; --behavior replace
</code></pre><p>In a real development you will probably need to include more customization, depending on the complexity of the Integration. You can learn more about all the details of Kustomize reading the official documentation.</p> <h2 id="prepare-production-integration">Prepare production Integration</h2> <p>What we have done, so far, should be good enough to enable GitOps on a development profile. Before testing it with some CD technology, let&rsquo;s prepare also the production profile.</p> <p>We can start creating the <code>kustomization.yaml</code> file in a very similar way we did for the development profile. Additionally we specify which is the new target namespace.</p> <pre tabindex="0"><code>cd ../../overlays/prod/
kustomize create --resources ../../base/
kustomize edit add configmap my-cm --from-literal=my-configmap-file=&#34;I am a production environment&#34; --behavior replace
kustomize edit set namespace prod
</code></pre><p>We should now prepare a yaml configuration file for those parameters we want to override from the base. It will be something like:</p> <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">camel.apache.org/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Integration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">camel.apache.org/operator.id</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-route</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">traits</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="m">10.110.251.124</span><span class="l">/default/camel-k-kit-cijrbp8vl1rc73dg99h0@sha256:038254c5c3d627eb230a1df2d6a140fb54d704f7d14443396e7273ee53d2ce3e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">limitCPU</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">limitMemory</span><span class="p">:</span><span class="w"> </span><span class="l">1024Mi</span><span class="w">
</span></span></span></code></pre></div><p>The first thing we need to do is to remove the <code>operator.id</code> annotation in order to let the production operator to pick up the resource for reconciliation (you may also decide to set the id of the operator that takes care to reconcile). Then, you can see we&rsquo;re specifically overriding the <code>.spec.trait.container.image</code> (which represent the container created and tested in development). The value can be taken from the Integration that has been tested, checking the <code>.spec.status.image</code> value. Finally we&rsquo;re editing the resources which are now wider in a production environment. Let&rsquo;s save this file as <code>settings.yaml</code>.</p> <p>We can use this file as a patch to Kustomize:</p> <pre tabindex="0"><code>kustomize edit add patch --path settings.yaml
</code></pre><p>If you&rsquo;re using a different technology such as <a href="https://helm.sh/docs/topics/charts/" rel="noopener nofollow noreferrer">Helm charts</a> or <a href="https://jsonnet.org/" rel="noopener nofollow noreferrer">Jsonnet</a> the configuration will change according to the spec. However, the fields you&rsquo;ll need to configure will be the same as we&rsquo;ve shown in Kustomize example.</p> <p>This production configuration is now ready to run in your CD technology. You can therefore create a repo or you can reuse the one we&rsquo;ve used in this example: <a href="https://github.com/squakez/camelk-gitops-example" rel="noopener nofollow noreferrer">https://github.com/squakez/camelk-gitops-example</a></p> <h2 id="run-with-argocd">Run with ArgoCD</h2> <p>When we talk about CD tools for GitOps, <a href="https://argo-cd.readthedocs.io/en/stable/" rel="noopener nofollow noreferrer">ArgoCD</a> results in the most popular choice. We will show some basic usage to integrate the application we&rsquo;ve prepared in the previous chapters, assuming you&rsquo;ve installed already ArgoCD on your Kubernetes cluster and you have some familiarity with it.</p> <p>For the sake of brevity I&rsquo;ll only show you how to apply to the production environment only.We start setting the default namespace to the one where ArgoCD is tipycally installed:</p> <pre tabindex="0"><code>kubectl config set-context --current --namespace=argocd
</code></pre><p>Now, assuming you have <code>argocd</code> CLI installed on your machine, we&rsquo;ll prepare the configuration required to run your Camel K application:</p> <pre tabindex="0"><code>argocd app create my-ck-it-prod --repo https://github.com/squakez/camelk-gitops-example.git --path overlays/prod --dest-server https://kubernetes.default.svc --dest-namespace prod
</code></pre><p>Notice that we&rsquo;re providing the Git repository path (the production overlay) and we specify the destination namespace. We also need to specify the destination cluster server, which, in our case, is a local Kubernetes cluster. Now that the application is installed, let&rsquo;s have a look at the status of the application:</p> <pre tabindex="0"><code>argocd app list

NAME                  CLUSTER                         NAMESPACE  PROJECT  STATUS     HEALTH   SYNCPOLICY  CONDITIONS  REPO                                                  PATH           TARGET
argocd/my-ck-it-prod  https://kubernetes.default.svc  prod       default  OutOfSync  Healthy  &lt;none&gt;      &lt;none&gt;      https://github.com/squakez/camelk-gitops-example.git  overlays/prod
</code></pre><p>You can see that the application status is <code>OutOfSync</code> which is normal the first time we install the application. Let&rsquo;s run a manual syncronization to have it started:</p> <pre tabindex="0"><code>argocd app sync my-ck-it-prod
...
2023-07-07T09:05:37+02:00  camel.apache.org  Integration        prod              my-route    Synced  Missing              integration.camel.apache.org/my-route created
</code></pre><p>The application should run immediately as, in the production profile we won&rsquo;t require a build (we&rsquo;ll use the IntegrationKit already tested in development environment):</p> <pre tabindex="0"><code>kamel logs my-route -n prod
...
[1] 2023-07-07 07:05:45,913 INFO  [info] (Camel (camel-1) thread #1 - timer://yaml) Exchange[ExchangePattern: InOnly, BodyType: String, Body: I am a production environment]
</code></pre><p>Well done. From now on the ArgoCD will take care to monitor the application and alert when some change happen on the source code in order to run the necessarily sync action. Let&rsquo;s make some change in the prod overlay. For example, we can change the text of the Configmap and we can reduce the number of memory required for the container.</p> <blockquote> <p>NOTE: changing the Configmap only may not trigger an Integration rebuild as Camel K is not able (<a href="https://github.com/apache/camel-k/issues/1235" rel="noopener nofollow noreferrer">yet</a>) to restart an Integration on Configmap/Secret hot reloads.</p> </blockquote> <p>We can perform all the tipycal Git workflow here (PRs, actions checks, etc). Once the changes will land on <code>main</code>, ArgoCD will notify the application has gone <code>OutOfSync</code></p> <pre tabindex="0"><code>argocd app list

NAME                  CLUSTER                         NAMESPACE  PROJECT  STATUS     HEALTH   SYNCPOLICY  CONDITIONS  REPO                                                  PATH           TARGET
argocd/my-ck-it-prod  https://kubernetes.default.svc  prod       default  OutOfSync  Healthy  &lt;none&gt;      &lt;none&gt;      https://github.com/squakez/camelk-gitops-example.git  overlays/prod
</code></pre><p>We can re-sync and see the changes applied immediately:</p> <pre tabindex="0"><code>argocd app sync my-ck-it-prod
kamel logs my-route -n prod
...
[1] 2023-07-07 07:58:16,906 INFO  [info] (Camel (camel-1) thread #1 - timer://yaml) Exchange[ExchangePattern: InOnly, BodyType: String, Body: I am a production environment [edited!]]
</code></pre><h1 id="conclusion">Conclusion</h1> <p><strong>GitOps</strong> is a very interesting deployment tecnique which result very handy when applied to Cloud Native and Microservices architecture. In the blog we&rsquo;ve seen how we can apply it to Camel K applications. We&rsquo;ve seen how tools such <strong>Kustomize</strong> and <strong>ArgoCD</strong> can easily integrates with the outcome expected by Camel K to run a multi environment application. We wanted to show you some unopinionated approach that will help you organize your own GitOps strategy in order to learn which are the most important configuration required for a Camel K application.</p> <p>The tools we&rsquo;ve provided here can be replaced by any other available in the market. Also the process can be adapted to your own. The main takeaway is how you can leverage the tested application which will be pushed to a given container registry, and how you can reuse the tested artifacts in the different environments that your process requires.</p> <div class="related"> <h3 id="related"><a class="anchor" href="#related"></a>Related posts</h3> <article class="blog doc"> <header aria-label="Blog post"> <a href="../../../../blog/2023/06/camel-k-maven-proxy/"><h1>How to configure a Maven proxy in Camel K</h1></a> <time itemprop="published" datetime="2023-06-12" title="Monday, June 12, 2023">June 12, 2023</time>, by <span rel="author">Pasquale Congiusti</span> </header> <p>One of the main effort we&rsquo;re putting in Camel K version 2 is to have a enterprise grade building system. Not that Camel K version 1 has not this capability, but some of the key features are not very explicit. So I thought that, while waiting for Camel K version 2 release, where we&rsquo;re making all this configuration explicit, I can share some tip on how to improve the capacity to build and have a production enterprise ready environment also in Camel K 1.</p> <p><a class="continue" href="../../../../blog/2023/06/camel-k-maven-proxy/">Continue reading &#10095;</a></p> <p> <a class="category" href="../../../../categories/Howtos/">HOWTOS</a><a class="category" href="../../../../categories/Camel-K/">CAMEL K</a><a class="category" href="../../../../categories/Operations/">OPERATIONS</a> </p> </article> <article class="blog doc"> <header aria-label="Blog post"> <a href="../../../../blog/2022/11/camel-k-jbang/"><h1>How to test an Integration for Camel K</h1></a> <time itemprop="published" datetime="2022-11-24" title="Thursday, November 24, 2022">November 24, 2022</time>, by <span rel="author">Pasquale Congiusti</span> </header> <p>Testing is probably one of those operations we use to repeat most of the time while building any application. Applications in Camel world are no difference. With the advent of Camel JBang, we have a unified place that can be used to perform our testing/fine tuning locally before moving to a higher environment. During the last years of development, we have noticed that testing or fine tuning an integration directly connected to a Cloud Native environment can result a bit cumbersome.</p> <p><a class="continue" href="../../../../blog/2022/11/camel-k-jbang/">Continue reading &#10095;</a></p> <p> <a class="category" href="../../../../categories/Howtos/">HOWTOS</a><a class="category" href="../../../../categories/Camel-K/">CAMEL K</a><a class="category" href="../../../../categories/Test/">TEST</a><a class="category" href="../../../../categories/JBang/">JBANG</a> </p> </article> <article class="blog doc"> <header aria-label="Blog post"> <a href="../../../../blog/2022/10/camel-k-cicd/"><h1>Camel K CICD</h1></a> <time itemprop="published" datetime="2022-10-06" title="Thursday, October 6, 2022">October 6, 2022</time>, by <span rel="author">Pasquale Congiusti</span> </header> <p>In Camel K version 10, we&rsquo;ve released the CLI `promote feature that provides Camel K an opinionated way of promoting an Integration through the stages of software development. This feature unlock the possibility to combine Camel K with external tooling and let the user develop according to any automated release process. We always ear about CI/CD (Continuous Integration/Continuous Delivery and/or Deployment), and in this blog we&rsquo;re going to see how to make it for any Camel K integration.</p> <p><a class="continue" href="../../../../blog/2022/10/camel-k-cicd/">Continue reading &#10095;</a></p> <p> <a class="category" href="../../../../categories/Howtos/">HOWTOS</a><a class="category" href="../../../../categories/Camel-K/">CAMEL K</a><a class="category" href="../../../../categories/Devops/">DEVOPS</a> </p> </article> <article class="blog doc"> <header aria-label="Blog post"> <a href="../../../../blog/2023/02/camel-k-release-1-12/"><h1>Camel K 1.12 release</h1></a> <time itemprop="published" datetime="2023-02-27" title="Monday, February 27, 2023">February 27, 2023</time>, by <span rel="author">Pasquale Congiusti</span> </header> <p>Image (c): Camel Vectors by Vecteezy Although we&rsquo;re already in Camel K 2.0 mode, we had not forgotten to bring new fresh features on version 1. Camel K 1.12.0 has just been released and it brings a lot of new interesting upgrades and features. This may be the last release of Camel K 1 major version as we aim to have a release of Camel K 2 during half of this year.</p> <p><a class="continue" href="../../../../blog/2023/02/camel-k-release-1-12/">Continue reading &#10095;</a></p> <p> <a class="category" href="../../../../categories/Releases/">RELEASES</a><a class="category" href="../../../../categories/Camel-K/">CAMEL K</a> </p> </article> <article class="blog doc"> <header aria-label="Blog post"> <a href="../../../../blog/2023/02/camel-k-roadmap-2023/"><h1>Camel K 2023 Roadmap</h1></a> <time itemprop="published" datetime="2023-02-06" title="Monday, February 6, 2023">February 6, 2023</time>, by <span rel="author">Pasquale Congiusti</span> </header> <p>Signpost png from pngtree.com/ We&rsquo;re in 2023 since a while (just if nobody has noticed yet&hellip;) and we&rsquo;ve taken the month of January to think about how to move Camel K development forward. We had a very good discussion about the new features we&rsquo;d like to see during this year and this blog is trying to resume those ideas collected. I am going to do my best to resume everybody&rsquo;s comments in a shared view in order to inspire any contributor to understand the direction we&rsquo;re willing to take.</p> <p><a class="continue" href="../../../../blog/2023/02/camel-k-roadmap-2023/">Continue reading &#10095;</a></p> <p> <a class="category" href="../../../../categories/Roadmap/">ROADMAP</a><a class="category" href="../../../../categories/Camel-K/">CAMEL K</a> </p> </article> </div> </div> </div> </article> </main> </div> <div class="footer-tools"> <a title="Improve this document, receive free virtual hugs &hearts;" href="https://github.com/apache/camel-website/edit/main/content/blog/2023/07/camel-k-gitops/index.md">Edit this Page</a> <a href="#top" title="Reach the top of the page">Back to top</a> </div> <footer> <div class="footer"> <figure class="logo"> <img class="logo" src="../../../../_/img/logo-d-a567cee6fa.svg" alt="Apache Camel Logo" aria-label="white silhouette of a camel in front of a sand dune"> </figure> <input id="footer-toggle-overview" type="checkbox" title="Show/Hide Overview section"> <dl> <dt><label for="footer-toggle-overview">Overview</label><label for="footer-toggle-overview">&#65291;</label></dt> <dd><a href="../../../../blog/">Blog</a></dd> <dd><a href="../../../../docs/">Documentation</a></dd> <dd><a href="../../../../community/support/">Community</a></dd> <dd><a href="../../../../download/">Download</a></dd> </dl> <input id="footer-toggle-documentation" type="checkbox" title="Show/Hide Documentation section"> <dl> <dt><label for="footer-toggle-documentation">Documentation</label><label for="footer-toggle-documentation">&#65291;</label></dt> <dd><a href="../../../../manual/">User Manual</a></dd> <dd><a href="../../../../components/next/index.html">Components</a></dd> <dd><a href="../../../../camel-k/next/">Camel-K</a></dd> <dd><a href="../../../../camel-kafka-connector/next/">Camel Kafka Connector</a></dd> <dd><a href="../../../../camel-quarkus/next/">Camel Quarkus</a></dd> <dd><a href="../../../../camel-spring-boot/next/">Camel Spring Boot</a></dd> <dd><a href="../../../../camel-karaf/3.22.x/">Camel Karaf</a></dd> <dd><a href="../../../../manual/faq/index.html">FAQ</a></dd> </dl> <input id="footer-toggle-community" type="checkbox" title="Show/Hide Community section"> <dl> <dt><label for="footer-toggle-community">Community</label><label for="footer-toggle-community">&#65291;</label></dt> <dd><a href="../../../../community/support/">Support</a></dd> <dd><a href="../../../../community/contributing/">Contributing</a></dd> <dd><a href="../../../../community/mailing-list">Mailing Lists</a></dd> <dd><a href="../../../../community/user-stories/">User stories</a></dd> <dd><a href="../../../../community/articles/">Articles</a></dd> <dd><a href="../../../../community/books/">Books</a></dd> <dd><a href="../../../../community/team/">Team</a></dd> </dl> <input id="footer-toggle-about" type="checkbox" title="Show/Hide Acknowledgements section"> <dl> <dt><label for="footer-toggle-about">About</label><label for="footer-toggle-about">&#65291;</label></dt> <dd><a href="../../../../acknowledgments/">Acknowledgments</a></dd> <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/events/current-event.html" title="Apache Events">Apache Events</a></dd> <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/licenses/" title="License">License</a></dd> <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/security/" title="Security">Security</a></dd> <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/foundation/sponsorship.html" title="Sponsorship">Sponsorship</a></dd> <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/foundation/thanks.html" title="Thanks">Thanks</a></dd> </dl> <p class="remark"> &copy; 2004-2024 The <a href="https://apache.org">Apache Software Foundation</a>.<br> Apache Camel, Camel, Apache, the Apache feather logo, and the Apache Camel project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners. </p> <div class="resources"> <div class="context"> <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a> </div> <div class="context"> <a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/foundation/policies/conduct">Code of Conduct</a> </div> <div class="context"> <a href="../../../../sitemap/">Sitemap</a> </div> </div> <div class="footer-icons"> <a rel="noopener noreferrer nofollow" href="https://github.com/apache/camel/" title="Collaborate on GitHub"><svg class="brand-icon" focusable="false"><use href="../../../../_/img/brand-logos-f2e689f4d4.svg#github"/></svg></a> <a rel="noopener noreferrer nofollow" href="https://camel.zulipchat.com" title="Chat on Zulip"><svg class="brand-icon" focusable="false"><use href="../../../../_/img/brand-logos-f2e689f4d4.svg#zulip"/></svg></a> <a rel="noopener noreferrer nofollow" href="https://twitter.com/ApacheCamel" title="Follow Apache Camel on Twitter"><svg class="brand-icon" focusable="false"><use href="../../../../_/img/brand-logos-f2e689f4d4.svg#twitter"/></svg></a> <a rel="noopener noreferrer nofollow" href="https://www.linkedin.com/groups/2447439/" title="Apache Camel group on Linkedin"><svg class="brand-icon" focusable="false"><use href="../../../../_/img/brand-logos-f2e689f4d4.svg#linkedin"/></svg></a> </div> </div> </footer> <script src="../../../../_/js/vendor/algoliasearch-bad45193e2.js"></script> <script src="../../../../_/js/site-c215fb6972.js"></script> <script async src="../../../../_/js/vendor/highlight-621a10fe1b.js"></script> <script async src="../../../../_/js/vendor/svg4everybody-a0c573f2b9.js"></script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Organization", "name": "Apache Camel", "url": "https:\/\/camel.apache.org\/" , "sameAs": ["https://twitter.com/ApacheCamel"] , "logo": "https:\/\/camel.apache.org\/_\/img\/logo-d.svg" , "description": "Apache Camel ™ is a versatile open-source integration framework based on known Enterprise Integration Patterns. Camel empowers you to define routing and mediation rules in a variety of domain-specific languages, including a Java-based Fluent API, Spring or Blueprint XML Configuration files, and a Scala DSL." } </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "BreadcrumbList", "itemListElement": [{ "@type": "ListItem", "position": 1 , "item": { "@id": "https://camel.apache.org/", "name": "Apache Camel" } },{ "@type": "ListItem", "position": 2 , "item": { "@id": "https://camel.apache.org/blog/", "name": "blog" } },{ "@type": "ListItem", "position": 3 , "item": { "@id": "https://camel.apache.org/blog/2023/", "name": "2023" } },{ "@type": "ListItem", "position": 4 , "item": { "@id": "https://camel.apache.org/blog/2023/07/", "name": "07" } },{ "@type": "ListItem", "position": 5 , "item": { "@id": "https://camel.apache.org/blog/2023/07/camel-k-gitops/", "name": "camel-k-gitops" } }] } </script> </body> </html> 