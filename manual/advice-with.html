<!doctype html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <title>AdviceWith :: Apache Camel</title> <link rel="canonical" href="https://camel.apache.org/manual/advice-with.html"> <meta name="generator" content="Antora 3.1.7"> <link rel="stylesheet" href="../_/css/site-b287b96c63.css"> <meta name="application-name" content="Apache Camel"> <meta property="og:title" content="AdviceWith"> <meta property="og:site_name" content="Apache Camel"> <meta property="og:url" content="https://camel.apache.org"> <meta property="og:description" content="Camel is an open source integration framework that empowers you to quickly and easily integrate various systems consuming or producing data."> <meta property="og:type" content="website"> <meta property="og:image" content="https://camel.apache.org/_/img/logo-d-a567cee6fa.svg"> <link rel="manifest" href="../site.webmanifest"> <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../apple-touch-icon-57x57.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../apple-touch-icon-114x114.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../apple-touch-icon-72x72.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../apple-touch-icon-144x144.png"> <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../apple-touch-icon-60x60.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../apple-touch-icon-120x120.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../apple-touch-icon-76x76.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../apple-touch-icon-152x152.png"> <link rel="icon" type="image/png" href="../favicon-196x196.png" sizes="196x196"> <link rel="icon" type="image/png" href="../favicon-96x96.png" sizes="96x96"> <link rel="icon" type="image/png" href="../favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="../favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="../favicon-128.png" sizes="128x128"> </head> <body class="article"> <header class="header"> <nav class="navbar" aria-label="Main menu"> <div class="navbar-brand"> <a class="nav-logo" href=".."></a> <div id="topbar-nav" class="navbar-menu"> <div class="navbar-end"> <a class="navbar-item-section navbar-item navbar-topics" href="../blog/"> <img alt="Blog" src="/_/img/blog-4c7fa4cb60.svg"> Blog </a> <a class="navbar-item-section navbar-item navbar-topics" href="../docs/"> <img alt="Documentation" src="/_/img/documentation-abb1b7f8b1.svg"> Documentation </a> <a class="navbar-item-section navbar-item navbar-topics" href="../community/"> <img alt="Community" src="/_/img/community-2ec8a3dc8b.svg"> Community </a> <a class="navbar-item-section navbar-item navbar-topics" href="../download/"> <img alt="Download" src="/_/img/download-63cdd75074.svg"> Download </a> <a class="navbar-item-section navbar-item navbar-topics" href="../security/"> <img alt="Security" src="/_/img/security-06abe157b3.svg"> Security </a> </div> </div> <div class="navbar-fill"></div> <div class="break-row"></div> <div class="navbar-search results-hidden"> <input id="search" class="search" placeholder="Search" autocomplete="off"> <img src="../_/img/cancel-1ed239489b.svg" alt="Clear" id="search-cancel"> <div id="search_results"></div> </div> <div class="navbar-tools"> <a rel="noopener noreferrer nofollow" href="https://github.com/apache/camel/" title="Collaborate on GitHub"><svg focusable="false" class="brand-icon"><use xlink:href="../_/img/brand-logos-f2e689f4d4.svg#github"/></svg></a> <a rel="noopener noreferrer nofollow" href="https://camel.zulipchat.com" title="Chat on Zulip"><svg focusable="false" class="brand-icon"><use xlink:href="../_/img/brand-logos-f2e689f4d4.svg#zulip"/></svg></a> <a rel="noopener noreferrer nofollow" href="https://twitter.com/ApacheCamel" title="Follow Apache Camel on Twitter"><svg focusable="false" class="brand-icon"><use xlink:href="../_/img/brand-logos-f2e689f4d4.svg#twitter"/></svg></a> <a rel="noopener noreferrer nofollow" href="https://www.linkedin.com/groups/2447439/" title="Apache Camel group on Linkedin"><svg focusable="false" class="brand-icon"><use xlink:href="../_/img/brand-logos-f2e689f4d4.svg#linkedin"/></svg></a> </div> <button class="navbar-burger" data-target="topbar-nav" type="button" aria-label="Menu"> <span></span> <span></span> <span></span> </button> </div> </nav> </header> <a id="top"></a> <div class="body"> <div class="nav-container" data-component="manual" data-version=""> <aside class="nav" aria-label="Side menu"> <div class="panels"> <div class="nav-panel-menu is-active"> <nav class="nav-menu" data-panel="menu" aria-label="Topics"> <h3 class="title"><a href="index.html">User manual</a></h3> <ul class="nav-list"> <li class="nav-item" data-depth="0"> <ul class="nav-list"> <li class="nav-item" data-depth="1"> <button class="nav-item-toggle" type="button" aria-label="Expand or contract topic"></button> <a class="nav-link" href="getting-started.html">Getting started</a> <ul class="nav-list"> <li class="nav-item" data-depth="2"> <a class="nav-link" href="book-getting-started.html">Getting Started with Apache Camel</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="what-are-the-dependencies.html">What are the dependencies?</a> </li> </ul> </li> <li class="nav-item" data-depth="1"> <button class="nav-item-toggle" type="button" aria-label="Expand or contract topic"></button> <span class="nav-text">Resources &amp; Guides</span> <ul class="nav-list"> <li class="nav-item" data-depth="2"> <a class="nav-link" href="/community/books/">Books</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="building.html">Building</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="camel-console.html">Camel Developer Console</a> </li> <li class="nav-item" data-depth="2"> <button class="nav-item-toggle" type="button" aria-label="Expand or contract topic"></button> <a class="nav-link" href="camel-jbang.html">Camel JBang</a> <ul class="nav-list"> <li class="nav-item" data-depth="3"> <a class="nav-link" href="camel-jbang-kubernetes.html">Camel Kubernetes plugin</a> </li> <li class="nav-item" data-depth="3"> <a class="nav-link" href="camel-jbang-k.html">Camel K plugin</a> </li> </ul> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="camel-maven-plugin.html">Camel Maven Plugin</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="camel-component-maven-plugin.html">Camel Component Maven Plugin</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="camel-report-maven-plugin.html">Camel Maven Report Plugin</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="camel-maven-archetypes.html">Camel Maven Archetypes</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="configuring-route-startup-ordering-and-autostartup.html">Configuring route startup ordering and autostartup</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="component-dsl.html">Component DSL</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="Endpoint-dsl.html">Endpoint DSL</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="dataformat-dsl.html">DataFormat DSL</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="examples.html">Examples</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="graceful-shutdown.html">Graceful Shutdown</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="error-handler.html">Error handler</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="using-propertyplaceholder.html">How to use Camel property placeholders</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="variables.html">How to use Variables</a> </li> <li class="nav-item" data-depth="2"> <button class="nav-item-toggle" type="button" aria-label="Expand or contract topic"></button> <a class="nav-link" href="testing.html">Testing</a> <ul class="nav-list"> <li class="nav-item" data-depth="3"> <a class="nav-link" href="test-infra.html">Test Infra</a> </li> <li class="nav-item" data-depth="3"> <a class="nav-link" href="notify-builder.html">NotifyBuilder</a> </li> <li class="nav-item is-current-page" data-depth="3"> <a class="nav-link" href="advice-with.html">AdviceWith</a> </li> </ul> </li> <li class="nav-item" data-depth="2"> <button class="nav-item-toggle" type="button" aria-label="Expand or contract topic"></button> <a class="nav-link" href="rest-dsl.html">Working with REST and Rest DSL</a> <ul class="nav-list"> <li class="nav-item" data-depth="3"> <a class="nav-link" href="rest-dsl-openapi.html">Rest DSL contract first</a> </li> </ul> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="writing-components.html">Writing Components</a> </li> <li class="nav-item" data-depth="2"> <button class="nav-item-toggle" type="button" aria-label="Expand or contract topic"></button> <a class="nav-link" href="release-guide.html">Release guide</a> <ul class="nav-list"> <li class="nav-item" data-depth="3"> <a class="nav-link" href="release-guide-website.html">Adding doc versions to the website</a> </li> </ul> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="improving-the-documentation.html">Improving the Documentation</a> </li> </ul> </li> <li class="nav-item" data-depth="1"> <button class="nav-item-toggle" type="button" aria-label="Expand or contract topic"></button> <a class="nav-link" href="migration-and-upgrade.html">Migration and Upgrade</a> <ul class="nav-list"> <li class="nav-item" data-depth="2"> <a class="nav-link" href="camel-3-migration-guide.html">Camel 2.x to 3.0 Migration Guide</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="camel-3x-upgrade-guide.html">Camel 3.x Upgrade Guide</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="camel-4-migration-guide.html">Camel 3.x to 4.0 Migration Guide</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="camel-4x-upgrade-guide.html">Camel 4.x Upgrade Guide</a> </li> </ul> </li> <li class="nav-item" data-depth="1"> <button class="nav-item-toggle" type="button" aria-label="Expand or contract topic"></button> <a class="nav-link" href="architecture.html">Architecture</a> <ul class="nav-list"> <li class="nav-item" data-depth="2"> <a class="nav-link" href="backlog-debugger.html">Backlog debugger</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="backlog-tracer.html">Backlog Tracer</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="batch-consumer.html">Batch Consumer</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="bean-binding.html">Bean Binding</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="bean-integration.html">Bean Integration</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="browsable-endpoint.html">BrowsableEndpoint</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="camelcontext.html">CamelContext</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="camelcontext-autoconfigure.html">CamelContext Auto Configuration</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="clustering.html">Clustering and Load Balancing</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="component.html">Component</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="data-format.html">Data Format</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="debugger.html">Debugger</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="delay-interceptor.html">Delayer</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="endpoint.html">Endpoints</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="endpoint-annotations.html">Endpoint Annotations</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="exception-clause.html">Exception Clause</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="exchange-pooling.html">Exchange Pooling</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="http-session-handling.html">HTTP-Session Handling</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="parameter-binding-annotations.html">Parameter Binding Annotations</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="pojo-producing.html">POJO Producing</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="pojo-consuming.html">POJO Consuming</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="producertemplate.html">ProducerTemplate</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="consumertemplate.html">ConsumerTemplate</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="error-handler.html">Error Handler</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="exchange.html">Message Exchange</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="exchange-pattern.html">Exchange Pattern</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="using-exchange-pattern-annotations.html">Using Exchange pattern annotations</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="expression.html">Expressions</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="../components/4.8.x/eips/content-enricher.html">Content Enrichment</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="injector.html">Injector</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="../components/4.8.x/eips/intercept.html">Intercept</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="jmx.html">JMX</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="lifecycle.html">Camel Lifecycle</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="oncompletion.html">OnCompletion</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="pluggable-class-resolvers.html">Pluggable Class Resolvers</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="predicate.html">Predicates</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="processor.html">Processor</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="registry.html">Registry</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="route-builder.html">RouteBuilder</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="lambda-route-builder.html">LambdaRouteBuilder</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="route-controller.html">RouteController</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="route-policy.html">RoutePolicy</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="route-configuration.html">RouteConfiguration</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="context-reload.html">ContextReload</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="route-reload.html">RouteReload</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="route-template.html">RouteTemplate</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="routes.html">Routes</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="startup-condition.html">Startup Condition</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="stream-caching.html">Stream caching</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="transformer.html">Transformer</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="threading-model.html">Threading Model</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="tracer.html">Tracer</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="type-converter.html">Type Converter</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="uris.html">URIs</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="uuidgenerator.html">UuidGenerator</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="validator.html">Validator</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="health-check.html">Health Checks</a> </li> </ul> </li> <li class="nav-item" data-depth="1"> <button class="nav-item-toggle" type="button" aria-label="Expand or contract topic"></button> <span class="nav-text">Domain Specific Languages</span> <ul class="nav-list"> <li class="nav-item" data-depth="2"> <a class="nav-link" href="dsl.html">Camel Domain Specific Language</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="languages.html">Languages</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="java-dsl.html">Java DSL</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="spring.html">Spring support</a> </li> </ul> </li> </ul> </li> <li class="nav-item" data-depth="0"> <ul class="nav-list"> <li class="nav-item" data-depth="1"> <button class="nav-item-toggle" type="button" aria-label="Expand or contract topic"></button> <a class="nav-link" href="faq/index.html">FAQ</a> <ul class="nav-list"> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/can-i-get-commercial-support.html">Can I get commercial support?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="/community/support/">How can I get help?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-can-i-get-the-source-code.html">How can I get the source code?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-camel-work.html">How does Camel work?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-the-website-work.html">How does the website work?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-become-a-committer.html">How do I become a committer?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-compile-the-code.html">How do I compile the code?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-edit-the-website.html">How do I edit the website?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/running-camel-standalone.html">Running Camel standalone</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/what-is-a-router.html">What is a router?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/what-is-camel.html">What is Camel?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/what-is-the-license.html">What is the license?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="languages.html">What languages are supported?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/what-platforms-are-supported.html">What platforms are supported?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-the-name-camel.html">Why the name Camel?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-specify-which-method-to-use-when-using-beans-in-routes.html">How do I specify which method to use when using beans in routes?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-can-i-create-a-custom-component-or-endpoint.html">How can I create a custom component or endpoint?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-can-i-get-the-remote-connection-ip-address-from-the-camel-cxf-consumer-.html">How can I get the remote connection IP address from the camel-cxf consumer ?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-can-i-stop-a-route-from-a-route.html">How can I stop a route from a route?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-can-webservice-clients-see-remote-faults-with-stacktraces-when-using-camel-cxf.html">How can webservice clients see remote faults with stacktraces when using camel-cxf?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-does-camel-look-up-beans-and-endpoints.html">How does Camel look up beans and endpoints?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-change-the-logging.html">How do I change the logging?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-configure-endpoints.html">How do I configure endpoints?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-configure-password-options-on-camel-endpoints-without-the-value-being-encoded.html">How do I configure password options on Camel endpoints without the value being encoded?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-configure-the-default-maximum-cache-size-for-producercache-or-producertemplate.html">How do I configure the default maximum cache size for ProducerCache or ProducerTemplate?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-configure-the-maximum-endpoint-cache-size-for-camelcontext.html">How do I configure the maximum endpoint cache size for CamelContext?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-debug-my-route.html">How do I debug my route?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-disable-jmx.html">How do I disable JMX?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-enable-streams-when-debug-logging-messages-in-camel.html">How do I enable streams when debug logging messages in Camel?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-handle-failures-when-consuming-for-example-from-a-ftp-server.html">How do I handle failures when consuming for example from a FTP server?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-import-rests-from-other-xml-files.html">How do I import rests from other XML files?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-import-routes-from-other-xml-files.html">How do I import routes from other XML files?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-let-jetty-match-wildcards.html">How do I let Jetty match wildcards?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-name-my-routes.html">How do I name my routes?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-restart-camelcontext.html">How do I restart CamelContext?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-retrieve-the-thrown-exception-during-processing-an-exchange.html">How do I retrieve the thrown Exception during processing an Exchange?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-retry-failed-messages-forever.html">How do I retry failed messages forever?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-retry-processing-a-message-from-a-certain-point-back-or-an-entire-route.html">How do I retry processing a message from a certain point back or an entire route?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-reuse-the-contexttestsupport-class-in-my-unit-tests.html">How do I reuse the ContextTestSupport class in my unit tests?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-set-the-max-chars-when-debug-logging-messages-in-camel.html">How do I set the max chars when debug logging messages in Camel?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-use-uris-with-parameters-in-xml.html">How do I use URIs with parameters in XML?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-write-a-custom-processor-which-sends-multiple-messages.html">How do I write a custom Processor which sends multiple messages?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-should-i-invoke-my-pojos-or-spring-services.html">How should I invoke my POJOs or Spring Services?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-avoid-sending-some-or-all-message-headers.html">How to avoid sending some or all message headers?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-remove-the-http-protocol-headers-in-the-camel-message.html">How to remove the http protocol headers in the camel message?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-send-the-same-message-to-multiple-endpoints.html">How to send the same message to multiple endpoints?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-switch-the-cxf-consumer-between-http-and-https-without-touching-the-spring-configuration.html">How to switch the CXF consumer between HTTP and HTTPS without touching the Spring configuration?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-to-use-a-dynamic-uri-in-to.html">How to use a dynamic URI in to()?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/is-there-an-ide.html">Is there an IDE?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/using-getin-or-getout-methods-on-exchange.html">Using getIn or getOut methods on Exchange</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-cant-i-use-sign-in-my-password.html">Why can&#8217;t I use + sign in my password?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-can-i-not-use-when-or-otherwise-in-a-java-camel-route.html">Why can I not use when or otherwise in a Java Camel route?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-does-ftp-component-not-download-any-files.html">Why does FTP component not download any files?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-does-my-file-consumer-not-pick-up-the-file-and-how-do-i-let-the-file-consumer-use-the-camel-error-handler.html">Why does my file consumer not pick up the file, and how do I let the file consumer use the Camel error handler?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-does-useoriginalmessage-with-error-handler-not-work-as-expected.html">Why does useOriginalMessage with error handler not work as expected?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-do-my-message-lose-its-headers-during-routing.html">Why do my message lose its headers during routing?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-is-my-message-body-empty.html">Why is my message body empty?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-is-my-processor-not-showing-up-in-jconsole.html">Why is my processor not showing up in JConsole?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-is-the-exception-null-when-i-use-onexception.html">Why is the exception null when I use onException?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-use-multiple-camelcontext.html">Why use multiple CamelContext?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-enable-debug-logging.html">How do I enable debug logging?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-use-log4j.html">How do I use log4j?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-make-my-jms-endpoint-transactional.html">How Do I Make My JMS Endpoint Transactional?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-i-set-the-mep-when-interacting-with-jbi.html">How do I set the MEP when interacting with JBI?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-the-direct-event-seda-and-vm-endpoints-compare.html">How do the direct, event, seda and vm endpoints compare?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/how-do-the-timer-and-quartz-endpoints-compare.html">How do the Timer and Quartz endpoints compare?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-does-my-jms-route-only-consume-one-message-at-once.html">Why does my JMS route only consume one message at once?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/exception-beandefinitionstoreexception.html">Exception - BeanDefinitionStoreException</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/exception-orgapachecamelnosuchendpointexception.html">Exception - org.apache.camel.NoSuchEndpointException</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/exception-orgxmlsaxsaxparseexception.html">Exception - org.xml.sax.SAXParseException</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/memory-leak-when-adding-and-removing-routes-at-runtime.html">Memory leak when adding and removing routes at runtime</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-does-camel-use-too-many-threads-with-producertemplate.html">Why does Camel use too many threads with ProducerTemplate?</a> </li> <li class="nav-item" data-depth="2"> <a class="nav-link" href="faq/why-does-maven-not-download-dependencies.html">Why does maven not download dependencies?</a> </li> </ul> </li> </ul> </li> <li class="nav-item" data-depth="0"> <ul class="nav-list"> <li class="nav-item" data-depth="1"> <span class="nav-text"><strong>Reference</strong></span> </li> <li class="nav-item" data-depth="1"> <a class="nav-link" href="../components/4.8.x/index.html">Components</a> </li> <li class="nav-item" data-depth="1"> <a class="nav-link" href="../components/4.8.x/dataformats/index.html">Data Formats</a> </li> <li class="nav-item" data-depth="1"> <a class="nav-link" href="../components/4.8.x/languages/index.html">Languages</a> </li> <li class="nav-item" data-depth="1"> <a class="nav-link" href="../components/4.8.x/eips/enterprise-integration-patterns.html">EIPs</a> </li> </ul> </li> </ul> </nav> </div> <div class="nav-panel-explore" data-panel="explore"> <div class="context"> <span class="title noversion">User manual</span> </div> <ul class="components"> <li class="component is-current"> <span class="title"> <a href="index.html">User manual</a> </span></li> <li class="component"><span class="title">Camel Components</span> <ul class="versions"> <li class="version"> <a href="../components/next/index.html">Next (Pre-release)</a> </li> <li class="version"> <a href="../components/4.8.x/index.html">4.8.x (LTS)</a> </li> <li class="version"> <a href="../components/4.4.x/index.html">4.4.x (LTS)</a> </li> <li class="version"> <a href="../components/3.22.x/index.html">3.22.x (LTS)</a> </li> </ul></li> <li class="component"> <span class="title"> <a href="../camel-core/index.html">Camel Core</a> </span></li> <li class="component"><span class="title">Camel K</span> <ul class="versions"> <li class="version"> <a href="../camel-k/next/index.html">Next (Pre-release)</a> </li> <li class="version"> <a href="../camel-k/2.4.x/index.html">2.4.x</a> </li> </ul></li> <li class="component"><span class="title">Camel Kafka Connector</span> <ul class="versions"> <li class="version"> <a href="../camel-kafka-connector/next/index.html">Next (Pre-release)</a> </li> <li class="version"> <a href="../camel-kafka-connector/4.8.x/index.html">4.8.x</a> </li> </ul></li> <li class="component"><span class="title">Kamelet Catalog</span> <ul class="versions"> <li class="version"> <a href="../camel-kamelets/next/index.html">Next (Pre-release)</a> </li> <li class="version"> <a href="../camel-kamelets/4.8.x/index.html">4.8.x (LTS)</a> </li> <li class="version"> <a href="../camel-kamelets/4.4.x/index.html">4.4.x (LTS)</a> </li> </ul></li> <li class="component"><span class="title">Camel Karaf</span> <ul class="versions"> <li class="version"> <a href="../camel-karaf/3.22.x/index.html">3.22.x (LTS)</a> </li> </ul></li> <li class="component"><span class="title">Camel Quarkus</span> <ul class="versions"> <li class="version"> <a href="../camel-quarkus/next/index.html">Next (Pre-release)</a> </li> <li class="version"> <a href="../camel-quarkus/3.15.x/index.html">3.15.x</a> </li> <li class="version"> <a href="../camel-quarkus/3.8.x/index.html">3.8.x</a> </li> </ul></li> <li class="component"><span class="title">Camel Spring Boot</span> <ul class="versions"> <li class="version"> <a href="../camel-spring-boot/next/index.html">Next (Pre-release)</a> </li> <li class="version"> <a href="../camel-spring-boot/4.8.x/index.html">4.8.x (LTS)</a> </li> <li class="version"> <a href="../camel-spring-boot/4.4.x/index.html">4.4.x (LTS)</a> </li> <li class="version"> <a href="../camel-spring-boot/3.22.x/index.html">3.22.x (LTS)</a> </li> </ul></li> </ul> </div> </div> </aside> </div> <main class="article"> <nav class="toolbar" aria-label="Toolbar"> <button class="nav-toggle" type="button" aria-label="Toggle submenu"></button> <nav class="breadcrumbs" aria-label="breadcrumbs"> <ul> <li><a href="index.html">User manual</a></li> <li>Resources &amp; Guides</li> <li><a href="testing.html">Testing</a></li> <li><a href="advice-with.html">AdviceWith</a></li> </ul> </nav> <div class="edit-this-page"><a href="https://github.com/apache/camel/edit/main/docs/user-manual/modules/ROOT/pages/advice-with.adoc">Edit this Page</a></div> </nav> <div class="content"> <article class="doc"> <h1 class="page">AdviceWith</h1> <div id="preamble"> <div class="sectionbody"> <div class="paragraph"> <p>AdviceWith is used for testing Camel routes where you can <em>advice</em> an existing route before its being tested.</p> </div> <div class="paragraph"> <p>What <code>adviceWith</code> allows is to change some factors on the route before the test is being run, such as:</p> </div> <div class="ulist"> <ul> <li> <p>Intercept sending to endpoints</p> </li> <li> <p>Replace incoming endpoint with another</p> </li> <li> <p>Take out or replace node(s) of the route</p> </li> <li> <p>Insert new node(s) into the route</p> </li> <li> <p>Mock endpoints</p> </li> </ul> </div> <div class="paragraph"> <p>All these features are available from <code>AdviceWithRouteBuilder</code>, which is a specialized <code>RouteBuilder</code>.</p> </div> </div> </div> <div class="sect1"> <h2 id="_advicewithroutebuilder_api"><a class="anchor" href="#_advicewithroutebuilder_api"></a>AdviceWithRouteBuilder API</h2> <div class="sectionbody"> <div class="paragraph"> <p>The <code>AdviceWithRouteBuilder</code> extends the regular <code>RouteBuilder</code> adding specialized methods for <em>advicing</em> routes. The table below lists the most commonly used methods:</p> </div> <div class="table-wrapper"><table class="tableblock frame-all grid-all stretch"> <colgroup> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Method</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>mockEndpoints</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Mocks all endpoints in the route.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>mockEndpoints(patterns)</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Mocks all endpoints in the route that matches the patterns. You can use wildcards and regular expressions in the given pattern to match multiple endpoints.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>mockEndpointsAndSkip(patterns)</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Mocks all endpoints and skip sending to the endpoint in the route that matches the patterns. You can use wildcards and regular expressions in the given pattern to match multiple endpoints.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>replaceFromWith(uri)</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">To replace the route input with a new endpoint.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>weaveByUri(pattern)</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Manipulates the route at the nodes sending to endpoints matching the pattern.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>weaveById(pattern)</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Manipulates the route at the node IDs that matches the pattern.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>weaveByToString(pattern)</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Manipulates the route at the node string representation(output from toString method) that matches the pattern.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>weaveByType(Class)</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Manipulates the route at the node type (class name) that matches the pattern.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>weaveAddFirst</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Easily weaves in new nodes at the beginning of the route.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>weaveAddLast</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Easily weaves in new nodes at the end of the route.</p></td> </tr> </tbody> </table></div> <div class="sect2"> <h3 id="_pattern_matching"><a class="anchor" href="#_pattern_matching"></a>Pattern matching</h3> <div class="paragraph"> <p>The pattern option is used for matching. It uses the same rules as <a href="../components/4.8.x/eips/intercept.html" class="xref page">Intercept</a>, which is applied in the following order:</p> </div> <div class="ulist"> <ul> <li> <p>match exact</p> </li> <li> <p>match by wildcard (<code>*</code>)</p> </li> <li> <p>match by regular expression</p> </li> </ul> </div> <div class="paragraph"> <p>For example, to match exact, you can use <code>weaveById("foo")</code> which will match only the id in the route which has the value foo. The wildcard is when the pattern ends with a <code>*</code> character, such as: <code>weaveById("foo*")</code> which will match any id&#8217;s starting with foo, such as: foo, foobar, foobie and so forth. The regular expression is more advanced and allows you to match multiple ids, such as <code>weaveById("(foo|bar)")</code> which will match both foo and bar.</p> </div> <div class="paragraph"> <p>If you try to match a pattern on an exact endpoint URI, then mind that URI options ordering may influence, and hence it&#8217;s best to match by wildcard.</p> </div> <div class="paragraph"> <p>For example, using <code>mockEndpointsAndSkip("activemq:queue:foo?*")</code> To match the foo queue and disregard any options.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_using_advicewith"><a class="anchor" href="#_using_advicewith"></a>Using AdviceWith</h2> <div class="sectionbody"> <div class="paragraph"> <p>To <em>advice</em> you need to use the <code>AdviceWithRouteBuilder</code> for manipulating the route. But first, you need to select which route to manipulate which you can do by the route ID or the route index.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AdviceWith.adviceWith(context, "myRoute", new AdviceWithRouteBuilder() {
        @Override
        public void configure() throws Exception {
            weaveAddLast().to("mock:result");
        }
});</code></pre> </div> </div> <div class="paragraph"> <p>We introduce a more modern API for <em>advicing</em> routes using Java lambda style.</p> </div> <div class="paragraph"> <p>Below, we are <em>advicing</em> the route with ID myRoute:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AdviceWith.adviceWith(context, "myRoute", a -&gt;
     a.weaveAddLast().to("mock:result")
);</code></pre> </div> </div> <div class="paragraph"> <p>The variable <code>a</code> is a lambda style of the <code>AdviceWithRouteBuilder</code> which can be used as shorthand for inlining the route manipulation.</p> </div> <div class="admonitionblock important"> <div class="table-wrapper"><table> <tr> <td class="icon"> <i class="fa icon-important" title="Important"></i> </td> <td class="content"> Before using <code>adviceWith</code> then it is best to tell Camel that advice is in use, which is covered in the following section. </td> </tr> </table></div> </div> <div class="sect2"> <h3 id="_enabling_advice_during_testing"><a class="anchor" href="#_enabling_advice_during_testing"></a>Enabling advice during testing</h3> <div class="paragraph"> <p>When <code>adviceWith</code> is being used, then Camel will restart the adviced routes. This happens because the route is manipulated, and Camel needs to:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Stop the existing route</p> </li> <li> <p>Remove the existing route</p> </li> <li> <p>Add the new advised route</p> </li> <li> <p>Start the new route</p> </li> </ol> </div> <div class="paragraph"> <p>This happens for every <em>adviced</em> route during startup of your unit tests. It happens quickly: a route is started and then is immediately stopped and removed. This is an undesired behavior; you want to avoid restarts of the <em>adviced</em> routes. This is solved by following the following steps:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Tell Camel that routes are being <em>adviced</em>, which will prevent Apache Camel from automatic starting routes.</p> </li> <li> <p>Advice the routes in your unit test methods</p> </li> <li> <p>Start Camel after you have <em>adviced</em> the routes</p> </li> </ol> </div> <div class="paragraph"> <p>When using <a href="../components/4.8.x/others/test-junit5.html" class="xref page">camel-test-junit5</a> for unit testing, then you can tell Camel that advice is in use by either overriding the <code>isUsedAdviceWith</code> method from <code>CamelTestSupport</code> as shown:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class MyAdviceWithTest extends CamelTestSupport {
    @Override
    public boolean isUseAdviceWith() {
        return true; // turn on advice with
    }
}</code></pre> </div> </div> <div class="paragraph"> <p>Or when using <a href="../components/4.8.x/others/test-spring-junit5.html" class="xref page">camel-test-spring-junit5</a> for unit testing you can use the <code>@UseAdviceWith</code> annotation as shown:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@UseAdviceWith
public class MyAdviceWithTest extends CamelSpringTestSupport {
}</code></pre> </div> </div> <div class="paragraph"> <p>Then you advise the routes followed by starting Camel:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
public void testMockEndpoints() throws Exception {
    AdviceWith.adviceWith(context, "myRoute", a -&gt;
         a.mockEndpoints();
    );

    context.start();</code></pre> </div> </div> <div class="paragraph"> <p>In the unit test method above, we first advise the route by ID, where we auto mock all the endpoints. After that we start Camel.</p> </div> </div> <div class="sect2"> <h3 id="_logging_before_and_after_advicing_routes"><a class="anchor" href="#_logging_before_and_after_advicing_routes"></a>Logging before and after advicing routes</h3> <div class="paragraph"> <p>When using <code>adviceWith</code> then Camel will automatically log, the before and after, of each adviced route, in XML format.</p> </div> <div class="paragraph"> <p>However, this requires to have <code>camel-xml-jaxb</code> as dependency, which you can add as test scoped if using Maven:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.camel&lt;/groupId&gt;
    &lt;artifactId&gt;camel-xml-jaxb&lt;/artifactId&gt;
    &lt;version&gt;x.x.x&lt;/version&gt;
    &lt;!-- use the same version as your Camel core version --&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre> </div> </div> <div class="paragraph"> <p>It is possible to turn of logging as XML, by setting the logging to <code>false</code> as shown:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AdviceWith.adviceWith(context, "myRoute", false, a -&gt;
     a.mockEndpoints();
);</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_replacing_route_endpoints"><a class="anchor" href="#_replacing_route_endpoints"></a>Replacing route endpoints</h3> <div class="paragraph"> <p>You may have built Camel routes that start from endpoints that consume from databases, message brokers, cloud systems, or other external systems.</p> </div> <div class="paragraph"> <p>To make unit testing these kinds of routes easier, you can replace the route input endpoints with internal endpoints such as <a href="../components/4.8.x/direct-component.html" class="xref page">direct</a>, <a href="../components/4.8.x/seda-component.html" class="xref page">seda</a>, <a href="../components/4.8.x/stub-component.html" class="xref page">stub</a>.</p> </div> <div class="paragraph"> <p>The following illustrates how to do this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Test
public void testReplaceFrom() throws Exception {
    AdviceWith.adviceWith(context, "myRoute", a -&gt;
        a.replaceFromWith("direct:start");
    );

    context.start();</code></pre> </div> </div> <div class="paragraph"> <p>This replaces the input endpoint (from) in the route with ID myRoute, with a direct endpoint, which makes it easy to send a message to the route when unit testing.</p> </div> </div> <div class="sect2"> <h3 id="_mocking_endpoints"><a class="anchor" href="#_mocking_endpoints"></a>Mocking endpoints</h3> <div class="paragraph"> <p>When using the <code>mockEndpoints</code> methods when <em>advicing</em> routes, then Camel will log during startup which endpoints have been <em>adviced</em> and their corresponding mock uri, such as:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-log hljs" data-lang="log">INFO  ceptSendToMockEndpointStrategy - Adviced endpoint [seda://camel] with mock endpoint [mock:seda:camel]
INFO  ceptSendToMockEndpointStrategy - Adviced endpoint [seda://other] with mock endpoint [mock:seda:other]</code></pre> </div> </div> <div class="paragraph"> <p>Here Camel have <em>adviced</em> two endpoints:</p> </div> <div class="ulist"> <ul> <li> <p>seda:camel -&#8594; mock:seda:camel</p> </li> <li> <p>seda:other -&#8594; mock:seda:other</p> </li> </ul> </div> <div class="paragraph"> <p>This allows using the mock endpoints in your unit tests for testing, such as:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void testMockEndpoints() throws Exception {
    // advice the route goes here
    // start camel after advice

    // use the auto mocked uris during testing
    getMockEndpoint("mock:seda:camel").expectedMessageCount(3);
    getMockEndpoint("mock:seda:other").expectedMessageCount(1);

    // send messages

    MockEndpoint.assertIsSatisfied(context);
}</code></pre> </div> </div> <div class="paragraph"> <p>Replacing the input endpoints, or mocking endpoints in Camel routes by using <code>adviceWith</code> is just the beginning of the route manipulation capabilities available. The following section covers how to go even deeper.</p> </div> </div> <div class="sect2"> <h3 id="_using_weave_to_amend_routes"><a class="anchor" href="#_using_weave_to_amend_routes"></a>Using weave to amend routes</h3> <div class="paragraph"> <p>When testing your Camel routes, you can use <code>adviceWith</code> to <em>weave</em> the routes before testing.</p> </div> <div class="paragraph"> <p>The following methods are available for the <code>weave</code> methods:</p> </div> <div class="table-wrapper"><table class="tableblock frame-all grid-all stretch"> <colgroup> <col> <col> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Method</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>remove</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Removes the selected node(s).</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>replace</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Replaces the selected node(s) with the following nodes.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>before</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Before the selected node(s), the following nodes is added.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>after</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">After the selected node(s), the following nodes is added.</p></td> </tr> </tbody> </table></div> <div class="paragraph"> <p>For example, given the following route:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:start")
  .to("mock:foo")
  .to("mock:bar").id("bar")
  .to("mock:result");</code></pre> </div> </div> <div class="paragraph"> <p>Then let&#8217;s go over the four methods to see how you can use them in unit tests</p> </div> <div class="sect3"> <h4 id="_replace"><a class="anchor" href="#_replace"></a>Replace</h4> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AdviceWith.adviceWith(context.getRouteDefinitions().get(0), context, new AdviceWithRouteBuilder() {
    @Override
    public void configure() throws Exception {
        // weave the node in the route which has id = bar
        // and replace it with the following route path
        weaveById("bar").replace().multicast().to("mock:a").to("mock:b");
    }
});</code></pre> </div> </div> <div class="paragraph"> <p>In this example we replace the <code>.to("mock:bar").id("bar")</code> with the <code>.multicast().to("mock:a").to("mock:b")</code>. That means instead of sending the message to a mock:bar endpoint, we do a Multicast to mock:a and mock:b endpoints instead.</p> </div> </div> <div class="sect3"> <h4 id="_remove"><a class="anchor" href="#_remove"></a>Remove</h4> <div class="paragraph"> <p>In the example below, we simply just remove the <code>.to("mock:bar").id("bar")</code> from the route:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AdviceWith.adviceWith(context.getRouteDefinitions().get(0), context, new AdviceWithRouteBuilder() {
    @Override
    public void configure() throws Exception {
        // weave the node in the route which has id = bar and remove it
        weaveById("bar").remove();
    }
});</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="_before"><a class="anchor" href="#_before"></a>Before</h4> <div class="paragraph"> <p>In the example below, we add the following nodes <code>to("mock:a").transform(constant("Bye World"))</code> before the node with the id bar.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AdviceWith.adviceWith(context.getRouteDefinitions().get(0), context, new AdviceWithRouteBuilder() {
    @Override
    public void configure() throws Exception {
        // weave the node in the route which has id = bar
        // and insert the following route path before the adviced node
        weaveById("bar").before().to("mock:a").transform(constant("Bye World"));
    }
});</code></pre> </div> </div> <div class="paragraph"> <p>That means the message being sent before to mock:bar would have been transformed to a constant message Bye World</p> </div> </div> <div class="sect3"> <h4 id="_after"><a class="anchor" href="#_after"></a>After</h4> <div class="paragraph"> <p>In the example below, we add the following nodes <code>to("mock:a").transform(constant("Bye World"))</code> after the node with the id bar.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">AdviceWith.adviceWith(context.getRouteDefinitions().get(0), context, new AdviceWithRouteBuilder() {
    @Override
    public void configure() throws Exception {
        // weave the node in the route which has id = bar
        // and insert the following route path after the advice node
        weaveById("bar").after().to("mock:a").transform(constant("Bye World"));
    }
});</code></pre> </div> </div> <div class="paragraph"> <p>That means the message being sent after mock:bar would have been transformed to a constant message Bye World</p> </div> </div> </div> <div class="sect2"> <h3 id="_weave_without_using_ids"><a class="anchor" href="#_weave_without_using_ids"></a>weave without using IDs</h3> <div class="paragraph"> <p>When weaving a route, you need to use one of the <code>weaveBy</code> methods as criteria to select one or more nodes in the route graph.</p> </div> <div class="paragraph"> <p>Suppose you use the <a href="../components/4.8.x/eips/split-eip.html" class="xref page">Split</a> EIP in a route; then you can use <code>weaveByType</code> to select this EIP. Given the following route:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("file:inbox").routeId("inbox")
    .split(body())
    .transform(simple("${body.toLowerCase()}"))
        .to("mock:line")
    .end()
    .to("mock:combined");</code></pre> </div> </div> <div class="paragraph"> <p>Due to that route has only one <a href="../components/4.8.x/eips/split-eip.html" class="xref page">Split</a> EIP, you can use <code>weaveByType</code> to find this single splitter in the route. Using <code>weaveByType</code> requires you to pass in the model type of the EIP. The name of the model type is using the pattern _name_Definition.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">weaveByType(SplitDefinition.class)
    .before()
        .transform(simple("${body},Camel is awesome"));</code></pre> </div> </div> <div class="paragraph"> <p>Here we weave and select the <a href="../components/4.8.x/eips/split-eip.html" class="xref page">Split</a> EIP and weave in a message transformation, that is processed before calling the splitter. This means the message body is appended with <em>Camel is awesome</em>.</p> </div> </div> <div class="sect2"> <h3 id="_weavebytouri"><a class="anchor" href="#_weavebytouri"></a>weaveByToUri</h3> <div class="paragraph"> <p>The <code>weaveByToUri</code> is a handy method that makes it easy to <em>weave</em> a Camel route that send messages to a given endpoint URI or pattern.</p> </div> <div class="paragraph"> <p>Given the following route having two branches in the <a href="../components/4.8.x/eips/choice-eip.html" class="xref page">Content Based Router</a> EIP:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("direct:start")
    .choice()
        .when(header("foo")).to("direct:branch-1")
    .otherwise()
        .to("direct:branch-2");</code></pre> </div> </div> <div class="paragraph"> <p>Then we want to easily unit test this route, that messages are sent branch-1 or branch-2. This can be done with the <code>weaveByToUri</code> as shown:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">weaveByToUri("direct:branch*").replace().to("mock:cheese");</code></pre> </div> </div> <div class="paragraph"> <p>Notice the <code>weaveByToUri</code> method is using a wildcard (<code>*</code>) to match the two branches.</p> </div> <div class="admonitionblock tip"> <div class="table-wrapper"><table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> You can also use <code>mockEndpoints</code> to auto mock instead of <code>weaveByToUri</code> in the example above. The <code>weave</code> methods have a lot more power to manipulate the route, such as message transformation, routing the message or much more. </td> </tr> </table></div> </div> </div> <div class="sect2"> <h3 id="_weaveaddfirst_and_weaveaddlast"><a class="anchor" href="#_weaveaddfirst_and_weaveaddlast"></a>weaveAddFirst and weaveAddLast</h3> <div class="paragraph"> <p>The <code>weaveAddFirst</code> and <code>weaveAddLast</code> is a shorthand to easily add nodes to the route. These methods can only add to an existing route. If you want to manipulate the route, then use the other <code>weave</code> methods as already covered.</p> </div> <div class="paragraph"> <p>The <code>weaveAddFirst</code> method adds in the beginning of the route, and <code>weaveAddLast</code> at the end. Using them works the same as the other <code>weaveBy</code> methods, so see above for examples.</p> </div> </div> <div class="sect2"> <h3 id="_weave_using_node_selection"><a class="anchor" href="#_weave_using_node_selection"></a>weave using node selection</h3> <div class="paragraph"> <p>The <code>weaveBy</code> methods, select all matching nodes, which can be anything from none, one, two, or more nodes. In those situations, you may want to narrow the selection to a specific node. This can be done by using the select methods:</p> </div> <div class="ulist"> <ul> <li> <p><code>selectFirst</code> Selects only the first node.</p> </li> <li> <p><code>selectLast</code> Selects only the last node.</p> </li> <li> <p><code>selectIndex(index)</code> Selects only the nth node. The index is zero-based.</p> </li> <li> <p><code>selectRange(from, to)</code> Selects the nodes within the given range. The index is zero-based.</p> </li> <li> <p><code>maxDeep(level)</code> Limits the selection to at most N levels deep in the Camel route tree. The first level is number 1. So number 2 is the children of the first-level nodes.</p> </li> </ul> </div> <div class="paragraph"> <p>Given the following route which has multiple <a href="../components/4.8.x/eips/filter-eip.html" class="xref page">Filter</a> EIP, then we want to only advise the second filter.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">from("file:inbox").routeId("inbox")
    .filter(header("foo"))
        .to("mock:foo")
    .end()
    .to("mock:a")
    .filter(header("bar"))
        .to("mock:bar")
    .end()
    .to("mock:b")
    .filter(header("cheese"))
        .to("mock:cheese")
    .end()
    .to("mock:c")</code></pre> </div> </div> <div class="paragraph"> <p>You can then use <code>weaveByType</code> to match the Filter EIPs and selectIndex to match the second found:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">weaveByType(FilterDefinition.class).selectIndex(1).replace().to("mock:changed");</code></pre> </div> </div> </div> </div> </div> </article> <aside class="toc sidebar" aria-label="Table of contents" data-title="Contents" data-levels="2"> <div class="toc-menu"></div> </aside> </div> </main> </div> <div class="footer-tools"> <a href="#top" title="Reach the top of the page">Back to top</a> </div> <footer> <div class="footer"> <figure class="logo"> <img src="../_/img/logo-d-a567cee6fa.svg" class="logo-small mt-60" alt="Apache Camel Logo" aria-label="white silhouette of a camel in front of a sand dune"> </figure> <input id="footer-toggle-overview" type="checkbox" title="Show/Hide Overview section"> <dl> <dt><label for="footer-toggle-overview">Overview</label><label for="footer-toggle-overview">&#65291;</label></dt> <dd><a href="../blog/">Blog</a></dd> <dd><a href="../docs/">Documentation</a></dd> <dd><a href="../community/support/">Community</a></dd> <dd><a href="../download/">Download</a></dd> </dl> <input id="footer-toggle-documentation" type="checkbox" title="Show/Hide Documentation section"> <dl> <dt><label for="footer-toggle-documentation">Documentation</label><label for="footer-toggle-documentation">&#65291;</label></dt> <dd><a href="../manual/">User Manual</a></dd> <dd><a href="../components/next/index.html">Components</a></dd> <dd><a href="../camel-k/next/">Camel-K</a></dd> <dd><a href="../camel-kafka-connector/next/">Camel Kafka Connector</a></dd> <dd><a href="../camel-quarkus/next/">Camel Quarkus</a></dd> <dd><a href="../camel-spring-boot/next/">Camel Spring Boot</a></dd> <dd><a href="../camel-karaf/3.22.x/">Camel Karaf</a></dd> <dd><a href="../manual/faq/index.html">FAQ</a></dd> </dl> <input id="footer-toggle-community" type="checkbox" title="Show/Hide Community section"> <dl> <dt><label for="footer-toggle-community">Community</label><label for="footer-toggle-community">&#65291;</label></dt> <dd><a href="../community/support/">Support</a></dd> <dd><a href="../community/contributing/">Contributing</a></dd> <dd><a href="../community/mailing-list/">Mailing Lists</a></dd> <dd><a href="../community/user-stories/">User stories</a></dd> <dd><a href="../community/articles/">Articles</a></dd> <dd><a href="../community/books/">Books</a></dd> <dd><a href="../community/team/">Team</a></dd> </dl> <input id="footer-toggle-about" type="checkbox" title="Show/Hide Acknowledgements section"> <dl> <dt><label for="footer-toggle-about">About</label><label for="footer-toggle-about">&#65291;</label></dt> <dd><a href="../acknowledgments/">Acknowledgments</a></dd> <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/events/current-event.html" title="Apache Events">Apache Events</a></dd> <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/licenses/" title="License">License</a></dd> <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/security/" title="Security">Security</a></dd> <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/foundation/sponsorship.html" title="Sponsorship">Sponsorship</a></dd> <dd><a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/foundation/thanks.html" title="Thanks">Thanks</a></dd> </dl> <p class="remark"> &copy; 2004-2024 The <a href="https://apache.org">Apache Software Foundation</a>.<br> Apache Camel, Camel, Apache, the Apache feather logo, and the Apache Camel project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners. </p> <div class="resources"> <div class="context"> <a href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a> </div> <div class="context"> <a target="_blank" rel="noopener noreferrer nofollow" href="https://www.apache.org/foundation/policies/conduct">Code of Conduct</a> </div> <div class="context"> <a href="../sitemap/">Sitemap</a> </div> </div> <div class="footer-icons"> <a rel="noopener noreferrer nofollow" href="https://github.com/apache/camel/" title="Collaborate on GitHub"><svg class="brand-icon" focusable="false"><use xlink:href="../_/img/brand-logos-f2e689f4d4.svg#github"/></svg></a> <a rel="noopener noreferrer nofollow" href="https://camel.zulipchat.com" title="Chat on Zulip"><svg class="brand-icon" focusable="false"><use xlink:href="../_/img/brand-logos-f2e689f4d4.svg#zulip"/></svg></a> <a rel="noopener noreferrer nofollow" href="https://twitter.com/ApacheCamel" title="Follow Apache Camel on Twitter"><svg class="brand-icon" focusable="false"><use xlink:href="../_/img/brand-logos-f2e689f4d4.svg#twitter"/></svg></a> <a rel="noopener noreferrer nofollow" href="https://www.linkedin.com/groups/2447439/" title="Apache Camel group on Linkedin"><svg class="brand-icon" focusable="false"><use xlink:href="../_/img/brand-logos-f2e689f4d4.svg#linkedin"/></svg></a> </div> </div> </footer> <script src="../_/js/vendor/algoliasearch-bad45193e2.js"></script> <script src="../_/js/site-c215fb6972.js"></script> <script async src="../_/js/vendor/highlight-621a10fe1b.js"></script> <script async src="../_/js/vendor/svg4everybody-a0c573f2b9.js"></script> <script async src="../_/js/vendor/tabs-5aea11bcf5.js" data-sync-storage-key="preferred-tab"></script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Organization", "name": "Apache Camel", "url": "https://camel.apache.org", "sameAs": [ "https://twitter.com/ApacheCamel" ], "logo": "../_/img/logo-d-a567cee6fa.svg", "description": "Apache Camel ™ is a versatile open-source integration framework based on known Enterprise Integration Patterns. Camel empowers you to define routing and mediation rules in a variety of domain-specific languages, including a Java-based Fluent API, Spring or Blueprint XML Configuration files, and a Scala DSL." } </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "BreadcrumbList", "itemListElement": [{ "@type": "ListItem", "position": 1, "name": "Apache Camel", "item": "https://camel.apache.org/" }, { "@type": "ListItem", "position": 2, "name": "User manual", "item": "https://camel.apache.org/manual/index.html" }, { "@type": "ListItem", "position": 3, "name": "default", "item": "https://camel.apache.org/manual/index.html" }, { "@type": "ListItem", "position": 4, "name": "Resources &amp; Guides", "item": "https://camel.apache.org/manual/index.html" }, { "@type": "ListItem", "position": 5, "name": "Testing", "item": "https://camel.apache.org/manual/testing.html" }, { "@type": "ListItem", "position": 6, "name": "AdviceWith", "item": "https://camel.apache.org/manual/advice-with.html" }] } </script> </body> </html> 